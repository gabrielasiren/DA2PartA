---
title: "Data Analytics II: Project Part A"
author: |
    | 57
    | Gabriela Siren, Didrik Gentili, Anna Gao, Ludwig Fredriksson
    | 25601, 25550, 25811, 25632
date: "2023-01-29"
output: pdf_document
df_print: paged
geometry: margin=2cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(readxl)
library(kableExtra)
library(ggplot2)
library(tibble)
library(rmarkdown)
library(knitr)
library(tidyverse)
library(tinytex)
library(dplyr)
```


```{r setup Importing data}
data <- read_excel("SegmentData57.xlsx")
```

## A.1 - Explorative Data Analysis (EDA)

```{r A.1.1 Statistics table: numerical variable and proportion}
stats <- function(x){c("Mean " = mean(x)
                       ,"Stan. Deviaton " = sd(x)
                       ,"Minimum " = min(x)
                       , "Q1 " = quantile(x,probs=0.25)
                       ," Median " = median(x)
                       , "Q3 " = quantile(x, probs = 0.75)
                       ,"Maximum " = max(x))}
summaryStatsTable <-sapply(c(data[1:1], data[3:4]),stats)


homedata = data[data$ownHome == "ownYes",]
subdata = data[data$subscribe == "subYes",]

ownHomem = sum(homedata$gender =="Male") /nrow(homedata)
ownHomef = sum(homedata$gender =="Female") /nrow(homedata)

subm = sum(subdata$gender =="Male") /nrow(subdata)
subf = sum(subdata$gender =="Female") /nrow(subdata)

mStats <- sum(data$gender == "Male") /nrow(data)
fStats <- sum(data$gender == "Female") /nrow(data)



H0 <- c(fStats, ownHomef, subf)
H1 <- c(mStats, ownHomem, subm)




categories <- rbind(H0,H1)
rownames(categories) = c("Female/False", "Male/True")

kables(
  list(
    kable(
      summaryStatsTable, digits = 2, col.names= c("Age","Income", "Kids"), valign = "t", booktabs = "True"
      )
  ,
    kable(
      categories, digits = 3, col.names = c("Gender","OwnsHome", "Subscribes"), valign = "t", booktabs = "True"
      )
  
  ),caption = "Summary table for all variables") %>%
kable_styling(latex_options = "hold_position")
```
This table tells me...

```{r A.1.1 Numerical variables by segment} 
ageSM <- data %>%
  group_by(Segment) %>%
    summarise("Mean"=mean(age),
              "StDev"= sd(age),
               "Minimum"= min(age),
               "Maximum"= max(age),
              "Q1" = quantile(age,probs=0.25),
              "Median"= median(age),
               "Q3" = quantile(age,probs=0.75))
kable(ageSM, digits = 2, caption = "Summary table for age")




incomeSM <- data %>%
  group_by(Segment) %>%
    summarise("Mean"=mean(income),
              "StDev"= sd(income),
               "Minimum"= min(income),
               "Maximum"= max(income),
              "Q1" = quantile(income,probs=0.25),
              "Median"= median(income),
               "Q3" = quantile(income,probs=0.75))
kable(incomeSM, digits = 2, caption = "Summary table for income")

kidsSM <- data %>%
  group_by(Segment) %>%
    summarise("Mean"=mean(kids),
              "StDev"= sd(kids),
               "Minimum"= min(kids),
               "Maximum"= max(kids),
              "Q1" = quantile(kids,probs=0.25),
              "Median"= median(kids),
               "Q3" = quantile(kids,probs=0.75))
kable(kidsSM, digits = 2, caption = "Summary table for children")

```

[your comments here]

```{r A.1.2 histograms}

d1 <- data$age
d2 <- data$income
d3 <- data$kids

hist(d1, breaks=30, main = "Histogram of Age", xlab= "Aggregate age")

hist(d2, breaks=100, main = "Histogram of Income", xlab= "Aggregate income")

hist(d3, breaks=5, main = "Histogram of Kids", xlab= "Aggregate kids")

```


```{r A.1.2 Boxplots}

#Aggregate income boxplot
boxplot(d2,
        main = "Aggregate Income boxplot",
        xlab = "Income",
        ylab = "Age",
        horizontal = TRUE,
        las=1)

#Segmented income boxplot
seg_sm<-data[data$Segment=="Suburb mix",]
seg_uh<-data[data$Segment=="Urban hip",]
seg_t<-data[data$Segment=="Travelers",]
seg_mu<-data[data$Segment=="Moving up",]


boxplot(data$income~data$Segment,
        main = "Boxplots for Segmented Income",
        names = c("Suburb Mix", "Urban Hip", "Travelers", "Moving Up"),
        las = 1,
        horizontal = TRUE,
        ylab = "",
        xlab = "Income",
        cex.axis = 0.7 # decrease the font label of the y axis
        )


```


[your comments here]

```{r A.1.3}

```

Do the variables Income and Age appear to be (approximately) normally distributed? 

Can you think of a suitable distribution for the variable children? 


## A.2 - Confidence Intervals

```{r A.2.1}
income_agg <- data$income
n <- length(income_agg)
m <- mean(income_agg)
s <- sd(income_agg)
t <- qt(0.95, n-1)

ME<- t * s/(n^(0.5))

LCL = m - ME
UCL = m + ME

print("aggreate lever income conficence interval at 90% confidence")
m
LCL
UCL

# to get the data from the segmented levels  and male / female look at how we did it in A.4.





```

[your comments here]

```{r A.2.2}

# In this part we are dealing with a true/false variable subsribers (a bool variable either subNo or subYes)
# we want to transform this to numbers so subYes becomes 1 and subNo becomes 0

# at aggregate level we get


n = nrow(data) 
p = sum(data$subscribe == "subYes")/n

#then look at p 284 in Newbold to figure out the confidence interval 





```

[your comments here]

```{r A.2.3}

```

Are the underlying assumptions for calculating this interval met in this data? 

## A.3 - Confidence Intervals and the Sample Size

```{r A.3.1 Part 1}


ME<-0.02
p<-0.5

n<-(((qnorm(0.95,0,1))^2)*(p*(1-p))/(ME^2))

#maximize p(1-p) -> p=0.5
#n=(z^2*p(1-p))/(ME^2)
#z=qnorm(0.95)
#assume big proportion

n

```


```{r A.3.2 Part 2}
ME<-0.01
p<-0.5

n<-(((qnorm(0.95,0,1))^2)*(p*(1-p))/(ME^2))

n
```


[your comments here]

```{r A.3.2}
ME<-0.01
p<-0.5

n<-(((qnorm(0.95,0,1))^2)*(p*(1-p))/(ME^2))

n
```

How should we adjust the confidence level as the size of the sample increases? Why?


## A.4 - Confidence Intervals: Comparison of Population Means

```{r A.4.i}
travelersdata = data[data$Segment == "Travelers",]
urban_hipdata = data[data$Segment == "Urban hip",]


# getting the samplesizes
nx = nrow(travelersdata)
ny = nrow(urban_hipdata)

# data for travelers
mx <- mean(travelersdata$income)
sx <- sd(travelersdata$income)
# data for urban

my <- mean(urban_hipdata$income)
sy <- sd(urban_hipdata$income)

# refer to 8.10 in Newbold p 318

v <- (sx^2/nx + sy^2/ny)^2/ ((sx^2/nx)^2/(nx-1) + (sy^2/ny)^2/(ny-1))

t <- qt(0.95, v)

ME <- t*(sx^2/nx + sy^2/ny)^(0.5)

LCL <- (mx-my) - ME
UCL <- (mx-my) + ME


print("The income differnce is:" )
print(mx-my)
print("the 90 % confidence interval is:")
print(LCL)
print("to")
print(UCL)





```

[your comments here]

Are underlying assumptions used to calculate this interval met in this data?

